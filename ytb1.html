<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘å­¦ä¹ ç³»ç»Ÿ - YouTube</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-image: url('bg2.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .glass-morphism {
            background: rgba(255, 255, 255, 0.96);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        /* ç¦ç”¨çŠ¶æ€ï¼šç°è‰²ã€ä¸å¯ç‚¹å‡» */
        .btn-disabled {
            background-color: #9ca3af !important;
            cursor: not-allowed;
            opacity: 0.6;
            pointer-events: none;
        }
        #login-overlay { transition: opacity 0.5s ease; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div id="login-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80">
        <div class="glass-morphism p-10 rounded-[2.5rem] shadow-2xl text-center max-w-sm w-full border-t-8 border-blue-500">
            <h2 class="text-3xl font-black text-blue-900 mb-2">æ¬¢è¿å­¦ä¹ </h2>
            <p class="text-gray-600 mb-8 font-medium">è¯·å…ˆè¾“å…¥å§“åä»¥è®°å½•è¿›åº¦</p>
            
            <input type="text" id="student-name" 
                   class="w-full p-4 border-4 border-blue-100 rounded-2xl mb-6 text-center text-2xl font-bold focus:border-blue-400 outline-none transition-all" 
                   placeholder="ä¸­æ–‡å§“å">
            
            <button id="login-btn" 
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-5 rounded-2xl text-xl shadow-xl transform transition active:scale-95">
                è¿›å…¥è§†é¢‘ (Start)
            </button>
        </div>
    </div>

    <div id="main-content" class="max-w-5xl w-full glass-morphism p-8 rounded-[3rem] shadow-2xl text-center opacity-0 transition-opacity duration-1000 border-4 border-white">
        <h1 id="page-title" class="text-4xl font-black text-blue-900 mb-6 drop-shadow-sm tracking-tight">
            è§†é¢‘åŠ è½½ä¸­...
        </h1>
        
        <div class="relative aspect-video bg-black rounded-3xl overflow-hidden shadow-2xl mb-8 border-4 border-gray-100">
            <div id="player"></div>
        </div>

        <div class="flex flex-col items-center space-y-6">
            <p id="statusHint" class="text-xl font-bold text-red-500 flex items-center">
                <span id="statusIcon" class="mr-2 animate-bounce">âš ï¸</span>
                <span id="statusText">è¯·å®Œæ•´çœ‹è§†é¢‘ï¼Œçœ‹å®Œåè‡ªåŠ¨æäº¤è®°å½•</span>
            </p>

            <div class="relative">
                <a href="index.html" id="homeBtn" 
                   class="btn-disabled inline-block bg-blue-600 text-white px-20 py-5 rounded-3xl text-2xl font-black shadow-2xl transition-all active:scale-90">
                    ğŸ  å›ä¸»é¡µ (Back to Home)
                </a>
                <p id="submit-notice" class="hidden absolute -bottom-10 left-0 right-0 text-green-600 font-black text-center animate-pulse">
                    âœ… è®°å½•å·²è‡ªåŠ¨å‘é€åˆ°è€å¸ˆåå°ï¼
                </p>
            </div>
        </div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
        // ================= åå°é…ç½®åŒº =================
        const config = {
            title: "è§†é¢‘å­¦ä¹ 0222â€”â€”çˆ±ä½ å“Ÿ", // é¡µé¢æ˜¾ç¤ºçš„æ ‡é¢˜
            videoId: '4RGnsu5eQ4o',        // ä½ æä¾›çš„ YouTube è§†é¢‘ ID
            
            // Google Form æ˜ å°„ (è¯·æ›¿æ¢ä¸ºä½ çœŸå®çš„ ID)
            googleFormURL: "https://docs.google.com/forms/d/e/1FAIpQLSck-tx8Vl6ERhptYGPhSd7vUYcKqLif8RGb4LI5GK2goW9OpA/formResponse", 
            entryIDs: {
                title: "entry.24104562", // å¯¹åº” Form ä¸­çš„ï¼šç»ƒä¹ æ ‡é¢˜
                name: "entry.178626966",  // å¯¹åº” Form ä¸­çš„ï¼šå§“å
                time: "entry.1112503934"   // å¯¹åº” Form ä¸­çš„ï¼šå®Œæˆæ—¶é—´
            }
        };

        let player;
        let userName = "";

        // --- 1. ç™»å½•å¤„ç† ---
        document.getElementById('login-btn').onclick = function() {
            const nameInput = document.getElementById('student-name').value.trim();
            if (!nameInput) {
                alert("è¯·è¾“å…¥å§“åï¼Please enter your name.");
                return;
            }
            userName = nameInput;
            
            // åŠ¨ç”»åˆ‡æ¢
            document.getElementById('login-overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('login-overlay').classList.add('hidden');
                const main = document.getElementById('main-content');
                main.classList.remove('opacity-0');
                document.getElementById('page-title').innerText = config.title;
            }, 500);
        };

        // --- 2. YouTube API åˆå§‹åŒ– ---
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: config.videoId,
                playerVars: {
                    'rel': 0,            // ä¸æ˜¾ç¤ºç›¸å…³è§†é¢‘
                    'modestbranding': 1, // éšè—å¤šä½™æ ‡å¿—
                    'controls': 1,       // æ˜¾ç¤ºæ§åˆ¶æ¡
                    'origin': window.location.origin
                },
                events: {
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        // --- 3. ç›‘å¬çŠ¶æ€ï¼šå½“è§†é¢‘æ’­æ”¾ç»“æŸ ---
        function onPlayerStateChange(event) {
            // YT.PlayerState.ENDED ä¸ºè§†é¢‘æ’­æ”¾ç»“æŸçš„çŠ¶æ€
            if (event.data === YT.PlayerState.ENDED) {
                handleStudyComplete();
            }
        }

        // --- 4. å®Œæˆåçš„é€»è¾‘ï¼šè§£é”å¹¶æäº¤ ---
        function handleStudyComplete() {
            // è§£é”æŒ‰é’®
            const homeBtn = document.getElementById('homeBtn');
            homeBtn.classList.remove('btn-disabled');
            homeBtn.classList.add('bg-green-600', 'hover:bg-green-700', 'scale-105');
            
            // çŠ¶æ€æ–‡å­—æ›´æ–°
            document.getElementById('statusText').innerText = "æ­å–œï¼å­¦ä¹ å·²å®Œæˆ";
            document.getElementById('statusIcon').innerText = "âœ…";
            document.getElementById('statusIcon').classList.remove('animate-bounce');
            document.getElementById('statusHint').className = "text-xl font-bold text-green-600 flex items-center";
            document.getElementById('submit-notice').classList.remove('hidden');

            // è‡ªåŠ¨æäº¤åˆ° Google Form
            submitToGoogleForm();
        }

        function submitToGoogleForm() {
            const now = new Date().toLocaleString('zh-CN', { hour12: false });
            
            // åŠ¨æ€åˆ›å»ºéšè—è¡¨å•æäº¤
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = config.googleFormURL;
            form.target = 'hidden_iframe'; // å…³é”®ï¼šæŒ‡å‘éšè—çš„ iframeï¼Œé˜²æ­¢é¡µé¢è·³è½¬
            form.style.display = 'none';

            const data = {
                [config.entryIDs.title]: config.title,
                [config.entryIDs.name]: userName,
                [config.entryIDs.time]: now
            };

            for (const key in data) {
                const input = document.createElement('input');
                input.name = key;
                input.value = data[key];
                form.appendChild(input);
            }

            // åˆ›å»ºéšè—çš„ IFrame å¤„ç†è¿”å›è¯·æ±‚
            const iframe = document.createElement('iframe');
            iframe.name = 'hidden_iframe';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            document.body.appendChild(form);

            form.submit();
            console.log("æäº¤æˆåŠŸ: " + userName + " åœ¨ " + now);
        }
    </script>
</body>
</html>