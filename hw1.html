<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­æ–‡å¬éŸ³è®¤å­—ç»ƒä¹ ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-image: url('bg1.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            margin: 0;
            padding: 0;
        }
        .glass-morphism {
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .hidden { display: none; }
        @keyframes trophy-bounce {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.1); }
        }
        .animate-trophy { animation: trophy-bounce 1.5s infinite ease-in-out; }
        .option-btn { transition: all 0.2s ease; }
        .option-btn:active { transform: scale(0.9); }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-6 font-sans">

    <div id="start-overlay" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-80">
        <div class="text-center">
            <button id="start-btn" class="bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white text-3xl font-bold px-16 py-8 rounded-full shadow-2xl transform transition hover:scale-105">
                ç‚¹å‡»å¼€å§‹ç»ƒä¹  ğŸš€<br><span class="text-sm block mt-2">Start Practice</span>
            </button>
        </div>
    </div>

    <div id="header-area" class="text-center mb-6 glass-morphism p-6 rounded-2xl shadow-lg w-full max-w-2xl">
        <h1 id="practice-title" class="text-4xl font-black text-blue-900 mb-2">ç»ƒä¹ ä¸€</h1>
        <p class="text-xl text-gray-700 font-bold">å¬ä¸€å¬ï¼Œé€‰ä¸€é€‰ã€‚Please listen and choose.</p>
    </div>

    <div class="w-full max-w-md bg-gray-300 rounded-full h-4 mb-8 shadow-inner overflow-hidden">
        <div id="progress-bar" class="bg-green-500 h-full transition-all duration-500 shadow-[0_0_10px_rgba(34,197,94,0.5)]" style="width: 0%"></div>
    </div>

    <div id="quiz-container" class="glass-morphism p-10 rounded-[3rem] shadow-2xl w-full max-w-4xl text-center relative border-8 border-white">
        <div id="timer" class="absolute top-6 right-10 text-red-600 font-black text-3xl italic">10s</div>
        
        <div id="options-grid" class="flex justify-center items-center gap-8 my-16 flex-wrap">
            </div>

        <div class="mt-4">
            <button id="replay-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-12 py-5 rounded-full font-bold text-2xl shadow-xl flex items-center mx-auto transition-all active:scale-95">
                <span class="mr-3 text-3xl">ğŸ”Š</span> é‡æ’­ (Replay)
            </button>
        </div>
    </div>

    <div id="review-container" class="hidden glass-morphism p-12 rounded-[3rem] shadow-2xl w-full max-w-3xl text-center border-8 border-red-100">
        <h2 class="text-3xl font-black text-red-600 mb-6 underline decoration-wavy">é”™é¢˜å›é¡¾ Review</h2>
        <div id="review-content" class="text-[12rem] leading-none mb-10 text-blue-900 font-bold drop-shadow-lg"></div>
        <button id="next-review-btn" class="bg-green-500 hover:bg-green-600 text-white px-16 py-6 rounded-3xl text-3xl font-black shadow-2xl transform transition active:scale-90">
            ç¡®è®¤ (Next)
        </button>
    </div>

    <div id="success-container" class="hidden text-center mt-4 glass-morphism p-12 rounded-[4rem] border-8 border-yellow-400 shadow-2xl max-w-2xl">
        <div class="text-[12rem] animate-trophy mb-6 drop-shadow-xl">ğŸ†</div>
        <h2 class="text-6xl font-black text-orange-600 mb-4">å¤ªæ£’äº†ï¼</h2>
        <p id="final-report" class="text-xl text-gray-800 mb-8 font-bold"></p>
        
        <div class="flex flex-col items-center gap-6">
            <div class="bg-green-100 text-green-700 py-3 px-10 rounded-full font-black border-4 border-green-500 inline-block animate-pulse">
                âœ… ä½œä¸šå·²è®°å½•å¹¶è‡ªåŠ¨æäº¤
            </div>
            <a href="index.html" class="bg-gray-800 hover:bg-black text-white px-12 py-4 rounded-2xl text-xl font-bold shadow-lg transition-colors flex items-center">
                ğŸ  å›ä¸»é¡µ (Back to Home)
            </a>
        </div>
    </div>

    <audio id="snd-correct" src="correct.mp3"></audio>
    <audio id="snd-wrong" src="wrong.mp3"></audio>
    <audio id="snd-cheer" src="cheer.mp3"></audio>

    <script>
        // ================= CONFIG é…ç½®åŒº =================
        const config = {
            title: "ç»ƒä¹ ä¸€",
            questions: [
                { answer: "è‹¹æœ", options: ["è‹¹æœ", "é¦™è•‰", "è¥¿ç“œ"] },
               /* { answer: "åŒ»ç”Ÿ", options: ["æŠ¤å£«", "åŒ»ç”Ÿ", "è€å¸ˆ"] },
                { answer: "è°¢è°¢", options: ["ä½ å¥½", "å¯¹ä¸èµ·", "è°¢è°¢"] },
                { answer: "çº¢è‰²", options: ["è“è‰²", "ç»¿è‰²", "çº¢è‰²"] },
                { answer: "å­¦æ ¡", options: ["åŒ»é™¢", "å­¦æ ¡", "å…¬å›­"] },
                { answer: "å†è§", options: ["ä½ å¥½", "è°¢è°¢", "å†è§"] },
                { answer: "å¦ˆå¦ˆ", options: ["çˆ¸çˆ¸", "å¦ˆå¦ˆ", "å“¥å“¥"] },
                { answer: "åŒ—äº¬", options: ["ä¸Šæµ·", "åŒ—äº¬", "å¹¿å·"] },
                { answer: "å†™å­—", options: ["è¯»ä¹¦", "å†™å­—", "ç”»ç”»"] },
                { answer: "å¿«ä¹", options: ["ä¼¤å¿ƒ", "ç”Ÿæ°”", "å¿«ä¹"] },
                { answer: "ä¸­å›½", options: ["ç¾å›½", "è‹±å›½", "ä¸­å›½"] },
                { answer: "æ˜¥å¤©", options: ["å¤å¤©", "ç§‹å¤©", "æ˜¥å¤©"] },
                { answer: "æœˆäº®", options: ["å¤ªé˜³", "æœˆäº®", "æ˜Ÿæ˜Ÿ"] },
                { answer: "é¢æ¡", options: ["ç±³é¥­", "åŒ…å­", "é¢æ¡"] },*/
                { answer: "è·‘æ­¥", options: ["æ¸¸æ³³", "è·³èˆ", "è·‘æ­¥"] }
            ],
            // Google Form é…ç½®
            googleFormURL: "https://docs.google.com/forms/d/e/1FAIpQLSck-tx8Vl6ERhptYGPhSd7vUYcKqLif8RGb4LI5GK2goW9OpA/formResponse", 
            entryIDs: {
                title: "entry.24104562",   // è¯·æ›¿æ¢ä¸ºçœŸå®çš„entry ID
                name: "entry.178626966",    
                errors: "entry.1112503934",  
                time: "entry.1751911239"     
            }
        };

        // ================= çŠ¶æ€ç®¡ç† =================
        let currentIdx = 0;
        let timer = 10;
        let timerInterval;
        let wrongWords = [];
        let userName = "";
        const synth = window.speechSynthesis;

        // ================= æ ¸å¿ƒæµç¨‹ =================

        document.getElementById('start-btn').onclick = () => {
            userName = prompt("è¯·è¾“å…¥ä½ çš„åå­— (Enter your name):") || "åŒ¿åå­¦ç”Ÿ";
            document.getElementById('start-overlay').classList.add('hidden');
            initQuiz();
        };

        function initQuiz() {
            document.getElementById('practice-title').innerText = config.title;
            loadQuestion();
        }

        function loadQuestion() {
            if (currentIdx >= config.questions.length) {
                startReview();
                return;
            }

            const q = config.questions[currentIdx];
            const grid = document.getElementById('options-grid');
            grid.innerHTML = '';
            
            document.getElementById('progress-bar').style.width = `${(currentIdx / config.questions.length) * 100}%`;

            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "option-btn bg-white border-4 border-blue-200 text-4xl p-10 rounded-[2.5rem] shadow-lg hover:border-blue-500 hover:bg-blue-50 font-black text-gray-800 min-w-[220px]";
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt);
                grid.appendChild(btn);
            });

            // è‡ªåŠ¨æ’­æ”¾
            setTimeout(() => {
                speak(q.answer);
                startTimer();
            }, 600);
        }

        function speak(text, rate = 0.85) {
            synth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-CN';
            utterance.rate = rate;
            synth.speak(utterance);
        }

        function startTimer() {
            timer = 10;
            document.getElementById('timer').innerText = `${timer}s`;
            document.getElementById('timer').classList.remove('scale-125');
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timer--;
                document.getElementById('timer').innerText = `${timer}s`;
                if(timer <= 3) document.getElementById('timer').classList.add('scale-125');
                if (timer <= 0) handleWrong();
            }, 1000);
        }

        function checkAnswer(selected) {
            clearInterval(timerInterval);
            const correct = config.questions[currentIdx].answer;
            if (selected === correct) {
                playFeedback(true);
                currentIdx++;
                setTimeout(loadQuestion, 1200);
            } else {
                handleWrong();
            }
        }

        function handleWrong() {
            clearInterval(timerInterval);
            playFeedback(false);
            wrongWords.push(config.questions[currentIdx].answer);
            currentIdx++;
            setTimeout(loadQuestion, 1200);
        }

        function playFeedback(isCorrect) {
            const id = isCorrect ? 'snd-correct' : 'snd-wrong';
            document.getElementById(id).play().catch(()=>{});
        }

        // ================= é”™é¢˜å›é¡¾é€»è¾‘ =================
        let reviewIdx = 0;
        function startReview() {
            if (wrongWords.length === 0) {
                finishAll();
                return;
            }
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('review-container').classList.remove('hidden');
            showReviewItem();
        }

        function showReviewItem() {
            const word = wrongWords[reviewIdx];
            document.getElementById('review-content').innerText = word;
            
            let count = 0;
            const repeatSpeak = () => {
                if(count < 3) {
                    speak(word, 0.7);
                    count++;
                    if(count < 3) setTimeout(repeatSpeak, 2000);
                }
            };
            repeatSpeak();

            document.getElementById('next-review-btn').onclick = () => {
                reviewIdx++;
                if (reviewIdx < wrongWords.length) {
                    showReviewItem();
                } else {
                    finishAll();
                }
            };
        }

        // ================= æäº¤ä¸å®Œæˆ =================
        function finishAll() {
            document.getElementById('review-container').classList.add('hidden');
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('success-container').classList.remove('hidden');
            document.getElementById('snd-cheer').play().catch(()=>{});
            
            const errorList = wrongWords.join(', ') || 'æ— ';
            document.getElementById('final-report').innerText = `å­¦ç”Ÿï¼š${userName} | é”™è¯æ¸…å•ï¼š${errorList}`;
            
            submitToGoogleForm(errorList);
        }

        function submitToGoogleForm(errorList) {
            const now = new Date().toLocaleString();
            
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = config.googleFormURL;
            form.target = 'hidden_iframe';
            form.style.display = 'none';

            const data = {
                [config.entryIDs.title]: config.title,
                [config.entryIDs.name]: userName,
                [config.entryIDs.errors]: errorList,
                [config.entryIDs.time]: now
            };

            for (const key in data) {
                const input = document.createElement('input');
                input.name = key;
                input.value = data[key];
                form.appendChild(input);
            }

            const iframe = document.createElement('iframe');
            iframe.name = 'hidden_iframe';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            document.body.appendChild(form);

            form.submit();
        }

        document.getElementById('replay-btn').onclick = () => {
            speak(config.questions[currentIdx].answer);
        };
    </script>
</body>
</html>
